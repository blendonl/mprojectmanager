enum TaskType {
  TASK
  SUBTASK
  MEETING

  @@map("task_type")
}

enum TaskPriority {
  LOW
  MEDIUM
  HIGH
  URGENT

  @@map("task_priority")
}

model Task {
  id         String  @id @default(uuid())
  columnId   String  @map("column_id")
  parentId   String? @map("parent_id")
  slug       String
  taskNumber Int     @map("task_number")

  title       String
  description String?
  position    Int          @default(0)
  type        TaskType     @default(TASK)
  priority    TaskPriority @default(LOW)

  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  dueAt     DateTime? @map("due_At")

  column   Column       @relation(fields: [columnId], references: [id], onDelete: Cascade)
  parent   Task?        @relation("Subtasks", fields: [parentId], references: [id], onDelete: Cascade)
  subtasks Task[]       @relation("Subtasks")
  logs     TaskLog[]
  timeLogs TimeLog[]
  agenda   AgendaItem[]

  @@index([slug])
  @@map("task")
}

enum TaskAction {
  CREATED
  MOVE_TO_IN_PROGRESS
  MOVE_TO_DONE
  MOVED_TO_COLUMN
  PRIORITY_CHANGED
  ASSIGNED
  UNASSIGNED
  COMPLETED
  REOPENED

  @@map("task_action")
}

model TaskLog {
  id     String @id @default(uuid())
  taskId String @map("task_id")

  action   TaskAction
  value    String?
  metadata Json?

  task Task @relation(fields: [taskId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("task_log")
}
